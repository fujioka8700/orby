# 要件定義書（Orby）

Phaser 3 を用いた横スクロールアクションゲームの要件を定義する。アクション仕様は NES「スーパーマリオブラザーズ 3」「星のカービィ 夢の泉の物語」を参考とする。

---

## 1. プロジェクト概要

| 項目         | 内容                                                            |
| ------------ | --------------------------------------------------------------- |
| ゲーム名     | Orby（仮）                                                      |
| ジャンル     | 横スクロールアクション                                          |
| 技術基盤     | Phaser 3（2D ゲームエンジン）                                   |
| 参考タイトル | スーパーマリオブラザーズ 3、星のカービィ 夢の泉の物語           |
| ステージ数   | 3 ステージ                                                      |
| 使用素材     | `src/public/orby/assets` 以下に配置された画像・マップ・フォント |

---

## 2. 参考タイトルから取り入れる要素

### 2.1 スーパーマリオブラザーズ 3

- 横スクロールのステージ進行
- 走る・ジャンプ・着地の操作性（慣性・減速）
- 敵との接触でミス、穴落下でミス
- 土管・ブロック・雲などのタイルマップ
- ワンウェイ（一方通行）足場の利用
- ゴール到達によるステージクリア

### 2.2 星のカービィ 夢の泉の物語

- シンプルな操作（移動・ジャンプ・能力の切り替えのイメージ）
- 敵を倒す／避ける選択
- 空中での軽い浮遊感（任意：短い滞空や二段ジャンプなど）
- ステージごとのテーマ（草原・洞窟・城など）と背景の差し替え
- ライフ（残機）とコイン／スターなどの収集要素

---

## 3. ステージ構成

| ステージ   | 想定テーマ | マップ・背景の利用                                            |
| ---------- | ---------- | ------------------------------------------------------------- |
| ステージ 1 | 草原・森   | 既存 `1st_stage_tilemap`、Forest / Sky / Grass 系タイル・背景 |
| ステージ 2 | 洞窟・水辺 | Stone / Brick 系タイル、Water / Lava 背景、はしご・橋など     |
| ステージ 3 | 城・最終   | Castle 背景、Hazard 多用、ゴール付近の難所                    |

- 各ステージは 1 マップ（Tiled で編集した JSON）で表現する。
- ステージ選択やクリア後は「次のステージへ」の遷移を用意する。

---

## 4. 使用素材一覧（src/public/orby/assets）

### 4.1 キャラクター

| 種別       | ファイル                         | 用途                                         |
| ---------- | -------------------------------- | -------------------------------------------- |
| プレイヤー | `graphics/characters/Player.png` | 操作キャラクター（走行・ジャンプ・待機など） |

### 4.2 敵キャラクター

| ファイル                   | 想定用途                         |
| -------------------------- | -------------------------------- |
| Spider_1.png, Spider_2.png | 地上・足場を移動する敵           |
| Bird_1.png, Bird_2.png     | 飛行する敵（一定範囲の巡回など） |
| Fish_1.png, Fish_2.png     | 水中・水エリアの敵               |
| Flame_1.png, Flame_2.png   | 炎・障害的な敵またはハザード     |

### 4.3 背景

| ファイル                                     | 想定用途                |
| -------------------------------------------- | ----------------------- |
| Forest_Background_0.png                      | ステージ 1 など森エリア |
| Sky_Background_0.png ～ Sky_Background_2.png | 空・屋外                |
| Castle_Background_0.png                      | ステージ 3 城エリア     |
| Clouds.png                                   | 空レイヤー装飾          |
| Water.png                                    | 水エリア                |
| Lava.png                                     | 溶岩・危険エリア        |

### 4.4 タイルセット（environment/tilesets）

| ファイル                                                                           | 想定用途                         |
| ---------------------------------------------------------------------------------- | -------------------------------- |
| Grass_Tileset.png, Grass_Oneway.png, Grass_Rock_Oneway.png, Grass_Rock_Tileset.png | 草原・土ブロック・ワンウェイ足場 |
| Brick_Oneway.png, Brick_Tileset.png                                                | 城・室内のブロック               |
| Stone_Tileset.png                                                                  | 洞窟・石壁                       |
| Leaf_Tileset.png                                                                   | 森の装飾                         |
| Cloud_Tileset.png                                                                  | 雲ブロック                       |
| Platform.png（interactive）                                                        | 足場・ワンウェイプラットフォーム |

### 4.5 インタラクティブ・ギミック（environment/interactive）

| ファイル                                                   | 想定用途                                   |
| ---------------------------------------------------------- | ------------------------------------------ |
| Bouncepad_Green.png, Bouncepad_Red.png, Bouncepad_Wood.png | ジャンプパッド（踏むと高く跳ぶ）           |
| Bridge.png, Ladder.png, Platform.png                       | 橋・はしご・足場                           |
| Rails.png, Rope.png, Vine.png                              | つり革・ロープ・つる（攀じ登りや移動経路） |

### 4.6 ハザード（environment/hazards）

| ファイル                                       | 想定用途               |
| ---------------------------------------------- | ---------------------- |
| Spike.png, Spike_Block.png, Spike_Platform.png | 接触でミスになる障害物 |
| Axe_Trap.png, Circular_Saw.png                 | 動くトラップ           |

### 4.7 アイテム（items）

| ファイル                                      | 想定用途                                     |
| --------------------------------------------- | -------------------------------------------- |
| Coin.png                                      | コイン（スコアまたはライフ延長）             |
| Star_Green.png, Star_Red.png, Star_Yellow.png | スター（スコア・クリア条件・パワーアップ等） |

### 4.8 UI（graphics/ui）

| ファイル     | 想定用途         |
| ------------ | ---------------- |
| Stars_Ui.png | 残機表示アイコン |
| Coins_Ui.png | コイン数表示     |
| Logo.png     | タイトル・ロゴ   |

### 4.9 フォント・マップ

| 種別     | パス                        | 用途                                           |
| -------- | --------------------------- | ---------------------------------------------- |
| フォント | `fonts/Round9x13.ttf`       | ゲーム内テキスト（スコア・残機・GAME OVER 等） |
| マップ   | `maps/*.tmx`, `maps/*.json` | Tiled で編集し、Phaser では JSON を読み込む    |

---

## 5. 機能要件

### 5.1 プレイヤー操作

- 左右移動（走行）、ジャンプ。
- 参考タイトルに合わせ、ある程度の慣性・減速（地上／空中の差）を考慮する。
- （任意）二段ジャンプや短い浮遊など、カービィ風の拡張。

### 5.2 衝突・ミス条件

- 敵キャラクターとの接触で 1 ミス（残機 1 減、初期位置から再開）。
- 地面のない穴への落下で 1 ミス。
- ハザード（スパイク・トラップ等）との接触で 1 ミス。
- 残機 0 でゲームオーバー（「GAME OVER」表示）。

### 5.3 残機・UI

- 残機は初期値 N（例: 2）。ミスごとに 1 減り、0 でゲームオーバー。
- 残機は `Stars_Ui.png` と数値で表示（フォントは Round9x13）。
- （任意）コイン数は `Coins_Ui.png` と数値で表示。

### 5.4 ステージ・ゴール

- ステージは横スクロールの 1 マップ。Tiled でレイヤー・オブジェクトを配置。
- ゴールオブジェクト（またはゴール領域）に到達でステージクリア。
- 3 ステージ分のマップ（JSON）を用意し、クリアごとに次ステージへ遷移する。

### 5.5 敵・ギミック

- 敵は種類に応じて挙動を実装（地上巡回、飛行、水中など）。
- ワンウェイ足場は下から乗ったときのみ有効。
- （任意）ジャンプパッドで高く跳ぶ、はしごで登る、など。

---

## 6. 非機能要件

- ブラウザ上で動作する Web ゲームとする。
- Phaser 3 で Canvas/WebGL 描画。Next.js アプリ内に組み込む。
- 使用する画像・マップ・フォントはすべて `src/public/orby/assets` から読み込む。

---

## 7. 用語・略語

| 用語       | 説明                                               |
| ---------- | -------------------------------------------------- |
| SMB3       | スーパーマリオブラザーズ 3                         |
| 夢の泉     | 星のカービィ 夢の泉の物語                          |
| ワンウェイ | 下からだけ乗れる一方通行の足場                     |
| Tiled      | タイルマップエディタ。出力は JSON を Phaser で使用 |
